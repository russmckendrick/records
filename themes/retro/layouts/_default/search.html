{{ define "window_title" }}
{{- if eq ($.Param "era") "modern" -}}
SEARCH COLLECTION
{{- else -}}
DATABASE QUERY TERMINAL
{{- end -}}
{{ end }}

{{ define "main" }}
<div class="database-terminal">
    <div class="query-interface">
        <div class="terminal-content" id="terminalContent">
            <div class="welcome-message">
                <div class="system-info">
                    {{- if eq ($.Param "era") "modern" -}}
                    <p>Music Collection Search</p>
                    <p>Total albums: <span id="recordCount">{{ len .Site.RegularPages }}</span></p>
                    <p>Total artists: <span id="artistCount">{{ len (where .Site.Pages "Section" "artist") }}</span></p>
                    <p>Enter an artist or album name to search, or <a href="#" onclick="showExamples(); return false;" class="examples-link">view examples</a>.</p>
                    {{- else -}}
                    <p>Database initialized: {{ now.Format "2006-01-02 15:04:05" }}</p>
                    <p>Records loaded: <span id="recordCount">{{ len .Site.RegularPages }}</span></p>
                    <p>Artists indexed: <span id="artistCount">{{ len (where .Site.Pages "Section" "artist") }}</span></p>
                    <p>Type 'HELP' for query syntax or <a href="#" onclick="showExamples(); return false;" class="examples-link">view example queries</a>.</p>
                    {{- end -}}
                </div>
            </div>
            
            <div class="current-prompt">
                <span class="prompt-user">user@russ-fm:~/collection$</span>
                <input type="text" 
                       id="queryInput" 
                       placeholder="{{ if eq ($.Param "era") "modern" }}Search for artist or album...{{ else }}Enter SQL query...{{ end }}"
                       autocomplete="off"
                       spellcheck="false">
            </div>
        </div>
    </div>

</div>

<!-- Example Queries Modal -->
<div id="examplesModal" class="examples-modal" onclick="hideExamples()">
    <div class="examples-modal-content" onclick="event.stopPropagation()">
        <div class="examples-modal-header">
            <h3>{{ if eq ($.Param "era") "modern" }}Example Searches{{ else }}Example Queries{{ end }}</h3>
            <button class="close-btn" onclick="hideExamples()">âœ•</button>
        </div>
        <div class="examples-modal-body">
            <div class="query-examples">
                <div class="example" onclick="executeExample('SELECT * FROM albums WHERE artist = &quot;Depeche Mode&quot;;'); hideExamples();">
                    <code>SELECT * FROM albums WHERE artist = "Depeche Mode";</code>
                </div>
                <div class="example" onclick="executeExample('SELECT artist, album FROM albums WHERE genre = &quot;Electronic&quot; LIMIT 10;'); hideExamples();">
                    <code>SELECT artist, album FROM albums WHERE genre = "Electronic" LIMIT 10;</code>
                </div>
                <div class="example" onclick="executeExample('SELECT COUNT(*) FROM albums WHERE style = &quot;Synth-pop&quot;;'); hideExamples();">
                    <code>SELECT COUNT(*) FROM albums WHERE style = "Synth-pop";</code>
                </div>
                <div class="example" onclick="executeExample('SELECT * FROM albums WHERE year > 1990 AND year < 2000 ORDER BY year;'); hideExamples();">
                    <code>SELECT * FROM albums WHERE year > 1990 AND year < 2000 ORDER BY year;</code>
                </div>
                <div class="example" onclick="executeExample('SHOW TABLES;'); hideExamples();">
                    <code>SHOW TABLES;</code>
                </div>
                <div class="example" onclick="executeExample('HELP'); hideExamples();">
                    <code>HELP</code>
                </div>
                <div class="example" onclick="executeExample('CLEAR'); hideExamples();">
                    <code>CLEAR</code>
                </div>
            </div>
        </div>
    </div>
</div>

.database-terminal {
    background: var(--window-bg);
    color: var(--text-color);
    font-family: var(--font-family);
    min-height: 80vh;
    margin: 2rem;
}



.query-interface {
    padding: 2rem;
}

.terminal-content {
    min-height: 400px;
    line-height: 1.6;
}

.system-info {
    margin-bottom: 2rem;
    color: var(--secondary-text);
}

.system-info p {
    margin: 0.5rem 0;
}

.examples-link {
    color: var(--accent-color);
    text-decoration: none;
}

.examples-link:hover {
    text-decoration: underline;
}

/* Examples Modal */
.examples-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    align-items: center;
    justify-content: center;
}

.examples-modal.active {
    display: flex;
}

.examples-modal-content {
    background: var(--window-bg);
    border: 2px solid var(--border-color);
    max-width: 90vw;
    max-height: 80vh;
    width: 800px;
    margin: 2rem;
    overflow-y: auto;
}

[data-era="modern"] .examples-modal-content {
    border: 2px outset #c0c0c0;
}

.examples-modal-header {
    background: var(--highlight-bg);
    border-bottom: 1px solid var(--border-color);
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.examples-modal-header h3 {
    margin: 0;
    color: var(--text-color);
    font-size: 1.2rem;
}

.examples-modal-body {
    padding: 2rem;
}

.query-examples {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 0.5rem;
}

.example {
    padding: 0.75rem;
    background: var(--highlight-bg);
    border: 1px solid var(--border-color);
    cursor: pointer;
    transition: all 0.3s ease;
}

.example:hover {
    background: var(--accent-color);
    color: var(--window-bg);
}

[data-era="modern"] .example {
    border: 1px inset #c0c0c0;
}

[data-era="modern"] .example:hover {
    border: 1px outset #c0c0c0;
    background: var(--highlight-bg);
    color: white;
}

.example code {
    font-family: var(--font-family);
    font-size: 0.9rem;
}


.current-prompt {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1rem;
}

.completed-command {
    color: var(--accent-color);
    font-weight: 600;
    margin-bottom: 0.5rem;
    margin-top: 1rem;
}

.converted-query {
    color: var(--secondary-text);
    font-style: italic;
    margin-bottom: 0.5rem;
    padding-left: 1rem;
    font-size: 0.9rem;
}

.command-result {
    margin-bottom: 1rem;
}

.prompt-user {
    color: var(--accent-color);
    font-weight: 600;
    min-width: fit-content;
}

#queryInput {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--text-color);
    font-family: var(--font-family);
    font-size: 1rem;
    padding: 0.5rem;
    outline: none;
}

#queryInput::placeholder {
    color: var(--secondary-text);
    opacity: 0.7;
}


.results-table {
    background: var(--window-bg);
    border: 1px solid var(--border-color);
    width: 100%;
    border-collapse: collapse;
}

[data-era="modern"] .results-table {
    border: 1px inset #c0c0c0;
}

.results-table th {
    background: var(--highlight-bg);
    color: var(--secondary-text);
    padding: 0.75rem;
    border-bottom: 1px solid var(--border-color);
    text-transform: uppercase;
    font-size: 0.8rem;
    font-weight: 600;
}

.results-table td {
    padding: 0.75rem;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-color);
}

.results-table tr:hover {
    background: var(--highlight-bg);
}

[data-era="modern"] .results-table tr:hover {
    background: var(--highlight-bg);
    color: white;
}

.result-link {
    color: var(--accent-color);
    text-decoration: none;
}

.result-link:hover {
    text-decoration: underline;
}

.result-count {
    color: var(--secondary-text);
    font-size: 0.9rem;
    margin-top: 1rem;
}

.error-message {
    color: #ff4444;
    background: rgba(255, 68, 68, 0.1);
    padding: 1rem;
    border: 1px solid #ff4444;
    margin-bottom: 1rem;
}

[data-era="modern"] .error-message {
    background: #ffcccc;
    color: #800000;
    border: 1px inset #c0c0c0;
}

.help-content {
    background: var(--highlight-bg);
    border: 1px solid var(--border-color);
    padding: 2rem;
    margin-bottom: 2rem;
}

[data-era="modern"] .help-content {
    border: 1px inset #c0c0c0;
}

.help-content h4 {
    color: var(--text-color);
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 0.5rem;
}

.help-content ul {
    list-style: none;
    padding: 0;
}

.help-content li {
    padding: 0.25rem 0;
    color: var(--secondary-text);
}

.help-content code {
    color: var(--accent-color);
    font-family: var(--font-family);
}

@media (max-width: 768px) {
    .database-terminal {
        margin: 1rem;
    }
    
    .query-examples {
        grid-template-columns: 1fr;
    }
    
    .query-interface {
        padding: 1rem;
    }
    
    .query-examples {
        font-size: 0.8rem;
    }
    
    .results-table {
        font-size: 0.8rem;
    }
    
    .results-table th,
    .results-table td {
        padding: 0.5rem;
    }
}

<script>
// Database search functionality
let searchIndex = null;
let commandHistory = [];
let historyIndex = -1;

// Load search index
fetch('/index.json')
    .then(response => response.json())
    .then(data => {
        searchIndex = data.documents;
        console.log('Search index loaded:', searchIndex.length, 'records');
    })
    .catch(error => {
        console.error('Failed to load search index:', error);
    });

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    const queryInput = document.getElementById('queryInput');
    
    queryInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            const query = queryInput.value.trim();
            if (query) {
                executeQuery(query);
                queryInput.value = '';
            }
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            if (historyIndex < commandHistory.length - 1) {
                historyIndex++;
                queryInput.value = commandHistory[commandHistory.length - 1 - historyIndex];
            }
        } else if (e.key === 'ArrowDown') {
            e.preventDefault();
            if (historyIndex > 0) {
                historyIndex--;
                queryInput.value = commandHistory[commandHistory.length - 1 - historyIndex];
            } else if (historyIndex === 0) {
                historyIndex = -1;
                queryInput.value = '';
            }
        }
    });
    
    // Focus input on page load
    queryInput.focus();
});

// Close modals with Escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        hideExamples();
    }
});

function executeExample(query) {
    document.getElementById('queryInput').value = query;
    executeQuery(query);
}

function executeQuery(query) {
    if (!searchIndex) {
        addCommandToHistory(query, null, 'Database not loaded. Please wait...');
        return;
    }
    
    // Add to history
    commandHistory.push(query);
    historyIndex = -1;
    
    // Check if it's a natural language query or SQL
    const convertedQuery = convertNaturalLanguageQuery(query);
    const actualQuery = convertedQuery.query;
    const isConverted = convertedQuery.converted;
    
    // Parse and execute query
    try {
        const result = parseAndExecuteQuery(actualQuery);
        
        if (actualQuery.trim().toUpperCase() === 'CLEAR') {
            clearTerminal();
            return;
        }
        
        if (result !== null) {
            // Show original query and converted query if different
            if (isConverted) {
                addCommandToHistory(query, result, null, convertedQuery.convertedSql);
            } else {
                addCommandToHistory(actualQuery, result);
            }
        }
    } catch (error) {
        addCommandToHistory(query, null, 'Query Error: ' + error.message);
    }
}

function parseAndExecuteQuery(query) {
    const normalizedQuery = query.trim().toUpperCase();
    
    // Handle special commands
    if (normalizedQuery === 'HELP') {
        return showHelp();
    }
    
    if (normalizedQuery === 'CLEAR') {
        return null; // Handled in executeQuery
    }
    
    if (normalizedQuery === 'SHOW TABLES;' || normalizedQuery === 'SHOW TABLES') {
        return {
            type: 'info',
            content: [
                { table: 'albums', description: 'Music album records' },
                { table: 'artists', description: 'Artist information' },
                { table: 'genres', description: 'Music genres' },
                { table: 'styles', description: 'Music styles' }
            ],
            headers: ['Table', 'Description']
        };
    }
    
    if (normalizedQuery === 'DESCRIBE ALBUMS;' || normalizedQuery === 'DESCRIBE ALBUMS') {
        return {
            type: 'info',
            content: [
                { field: 'artist', type: 'VARCHAR(255)', description: 'Artist name' },
                { field: 'album', type: 'VARCHAR(255)', description: 'Album title' },
                { field: 'year', type: 'INT', description: 'Release year' },
                { field: 'genre', type: 'TEXT', description: 'Music genres' },
                { field: 'style', type: 'TEXT', description: 'Music styles' },
                { field: 'release_id', type: 'VARCHAR(50)', description: 'Discogs release ID' }
            ],
            headers: ['Field', 'Type', 'Description']
        };
    }
    
    // Parse SELECT queries
    const selectMatch = query.match(/SELECT\s+(.*?)\s+FROM\s+(\w+)(?:\s+WHERE\s+(.+?))?(?:\s+ORDER\s+BY\s+(.+?))?(?:\s+LIMIT\s+(\d+))?;?$/i);
    
    if (selectMatch) {
        const [, fields, table, whereClause, orderBy, limit] = selectMatch;
        
        if (table.toLowerCase() !== 'albums') {
            throw new Error('Only "albums" table is supported');
        }
        
        let results = [...searchIndex];
        
        // Apply WHERE clause
        if (whereClause) {
            results = applyWhereClause(results, whereClause);
        }
        
        // Apply ORDER BY
        if (orderBy) {
            results = applyOrderBy(results, orderBy);
        }
        
        // Apply LIMIT
        if (limit) {
            results = results.slice(0, parseInt(limit));
        }
        
        // Select fields
        const selectedFields = fields.trim() === '*' ? null : 
            fields.split(',').map(f => f.trim().toLowerCase());
        
        // Handle COUNT
        if (fields.trim().toUpperCase() === 'COUNT(*)') {
            return {
                type: 'count',
                content: [{ count: results.length }],
                headers: ['COUNT(*)']
            };
        }
        
        return {
            type: 'select',
            content: results,
            headers: selectedFields,
            totalCount: results.length
        };
    }
    
    throw new Error('Invalid query syntax. Type HELP for assistance.');
}

function applyWhereClause(results, whereClause) {
    // Handle nested queries for albums
    const nestedMatch = whereClause.match(/artist\s*=\s*\(SELECT\s+artist\s+FROM\s+albums\s+WHERE\s+album\s*=\s*["']([^"']+)["']\s*LIMIT\s*1\)/i);
    if (nestedMatch) {
        const albumName = nestedMatch[1];
        const albumRecord = results.find(record => record.album && record.album.toLowerCase() === albumName.toLowerCase());
        if (albumRecord) {
            return results.filter(record => record.artist === albumRecord.artist);
        }
        return [];
    }
    
    // Handle OR conditions (for natural language searches)
    if (whereClause.includes(' OR ')) {
        const orConditions = whereClause.split(/\s+OR\s+/i);
        return results.filter(record => {
            return orConditions.some(condition => {
                return evaluateCondition(record, condition.trim());
            });
        });
    }
    
    // Handle AND conditions
    const conditions = whereClause.split(/\s+AND\s+/i);
    
    return results.filter(record => {
        return conditions.every(condition => {
            return evaluateCondition(record, condition.trim());
        });
    });
}

function evaluateCondition(record, condition) {
    // Handle LIKE operator
    const likeMatch = condition.match(/(\w+)\s+LIKE\s+["']%([^%"']+)%["']/i);
    if (likeMatch) {
        const [, field, value] = likeMatch;
        const fieldValue = getFieldValue(record, field.toLowerCase());
        if (fieldValue === null || fieldValue === undefined) return false;
        return fieldValue.toString().toLowerCase().includes(value.toLowerCase());
    }
    
    // Handle regular operators
    const match = condition.match(/(\w+)\s*(=|>|<|>=|<=|!=)\s*["']?([^"']+)["']?/i);
    if (!match) return true;
    
    const [, field, operator, value] = match;
    const fieldValue = getFieldValue(record, field.toLowerCase());
    
    if (fieldValue === null || fieldValue === undefined) return false;
    
    switch (operator) {
        case '=':
            return fieldValue.toString().toLowerCase().includes(value.toLowerCase());
        case '!=':
            return !fieldValue.toString().toLowerCase().includes(value.toLowerCase());
        case '>':
            return parseInt(fieldValue) > parseInt(value);
        case '<':
            return parseInt(fieldValue) < parseInt(value);
        case '>=':
            return parseInt(fieldValue) >= parseInt(value);
        case '<=':
            return parseInt(fieldValue) <= parseInt(value);
        default:
            return true;
    }
}

function applyOrderBy(results, orderBy) {
    const [field, direction] = orderBy.trim().split(/\s+/);
    const isDesc = direction && direction.toUpperCase() === 'DESC';
    
    return results.sort((a, b) => {
        const aVal = getFieldValue(a, field.toLowerCase());
        const bVal = getFieldValue(b, field.toLowerCase());
        
        if (aVal < bVal) return isDesc ? 1 : -1;
        if (aVal > bVal) return isDesc ? -1 : 1;
        return 0;
    });
}

function getFieldValue(record, field) {
    switch (field) {
        case 'artist':
            return record.artist || '';
        case 'album':
            return record.album || '';
        case 'title':
            return record.title || '';
        case 'year':
            const year = record.date ? new Date(record.date).getFullYear() : 0;
            return year;
        case 'genre':
            return Array.isArray(record.genres) ? record.genres.join(', ') : '';
        case 'style':
            return Array.isArray(record.styles) ? record.styles.join(', ') : '';
        case 'release_id':
            return record.discogsRelease || '';
        default:
            return record[field] || '';
    }
}

function addCommandToHistory(query, result, errorMessage = null, convertedSql = null) {
    const terminalContent = document.getElementById('terminalContent');
    const currentPrompt = document.querySelector('.current-prompt');
    
    // Create completed command display
    const commandDiv = document.createElement('div');
    commandDiv.className = 'completed-command';
    commandDiv.textContent = `user@russ-fm:~/collection$ ${query}`;
    
    // Insert before current prompt
    terminalContent.insertBefore(commandDiv, currentPrompt);
    
    // If query was converted, show the SQL version
    if (convertedSql) {
        const convertedDiv = document.createElement('div');
        convertedDiv.className = 'converted-query';
        convertedDiv.textContent = `Converted: ${convertedSql}`;
        terminalContent.insertBefore(convertedDiv, currentPrompt);
    }
    
    // Create result display
    const resultDiv = document.createElement('div');
    resultDiv.className = 'command-result';
    
    if (errorMessage) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.textContent = errorMessage;
        resultDiv.appendChild(errorDiv);
    } else if (result) {
        if (result.type === 'help') {
            resultDiv.appendChild(result.content);
        } else if (result.type === 'info' || result.type === 'select' || result.type === 'count') {
            const table = createResultTable(result);
            resultDiv.appendChild(table);
            
            if (result.totalCount !== undefined) {
                const countDiv = document.createElement('div');
                countDiv.className = 'result-count';
                countDiv.textContent = `${result.totalCount} row(s) returned`;
                resultDiv.appendChild(countDiv);
            }
        }
    }
    
    // Insert result before current prompt
    terminalContent.insertBefore(resultDiv, currentPrompt);
    
    // Clear current input and focus it
    const queryInput = document.getElementById('queryInput');
    queryInput.value = '';
    queryInput.focus();
    
    // Scroll to bottom
    currentPrompt.scrollIntoView({ behavior: 'smooth' });
}

function createResultTable(result) {
    const table = document.createElement('table');
    table.className = 'results-table';
    
    // Headers
    const thead = document.createElement('thead');
    const headerRow = document.createElement('tr');
    
    if (result.type === 'count') {
        const th = document.createElement('th');
        th.textContent = 'COUNT(*)';
        headerRow.appendChild(th);
    } else if (result.headers) {
        if (result.type === 'info') {
            result.headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
        } else {
            result.headers.forEach(field => {
                const th = document.createElement('th');
                th.textContent = field.toUpperCase();
                headerRow.appendChild(th);
            });
        }
    } else {
        // Default headers for SELECT *
        ['ARTIST', 'ALBUM', 'YEAR', 'GENRE', 'STYLE'].forEach(header => {
            const th = document.createElement('th');
            th.textContent = header;
            headerRow.appendChild(th);
        });
    }
    
    thead.appendChild(headerRow);
    table.appendChild(thead);
    
    // Body
    const tbody = document.createElement('tbody');
    
    result.content.forEach(record => {
        const row = document.createElement('tr');
        
        if (result.type === 'count') {
            const td = document.createElement('td');
            td.textContent = record.count;
            row.appendChild(td);
        } else if (result.type === 'info') {
            Object.values(record).forEach(value => {
                const td = document.createElement('td');
                td.textContent = value;
                row.appendChild(td);
            });
        } else {
            if (result.headers) {
                result.headers.forEach(field => {
                    const td = document.createElement('td');
                    const value = getFieldValue(record, field);
                    
                    // Create clickable links for artists and albums
                    if (field === 'artist' && record.artistUri) {
                        const link = document.createElement('a');
                        link.href = record.artistUri;
                        link.textContent = value;
                        link.className = 'result-link';
                        td.appendChild(link);
                    } else if (field === 'album' && record.uri) {
                        const link = document.createElement('a');
                        link.href = record.uri;
                        link.textContent = value;
                        link.className = 'result-link';
                        td.appendChild(link);
                    } else {
                        td.textContent = value;
                    }
                    
                    row.appendChild(td);
                });
            } else {
                // Default fields for SELECT *
                const fields = ['artist', 'album', 'year', 'genre', 'style'];
                fields.forEach(field => {
                    const td = document.createElement('td');
                    const value = getFieldValue(record, field);
                    
                    // Create clickable links for artists and albums
                    if (field === 'artist' && record.artistUri) {
                        const link = document.createElement('a');
                        link.href = record.artistUri;
                        link.textContent = value;
                        link.className = 'result-link';
                        td.appendChild(link);
                    } else if (field === 'album' && record.uri) {
                        const link = document.createElement('a');
                        link.href = record.uri;
                        link.textContent = value;
                        link.className = 'result-link';
                        td.appendChild(link);
                    } else {
                        td.textContent = value;
                    }
                    
                    row.appendChild(td);
                });
            }
        }
        
        tbody.appendChild(row);
    });
    
    table.appendChild(tbody);
    return table;
}

function showHelp() {
    const helpDiv = document.createElement('div');
    helpDiv.className = 'help-content';
    
    helpDiv.innerHTML = `
        <h4>SQL Query Syntax</h4>
        <ul>
            <li><code>SELECT * FROM albums;</code> - Show all albums</li>
            <li><code>SELECT artist, album FROM albums;</code> - Show specific fields</li>
            <li><code>SELECT COUNT(*) FROM albums;</code> - Count records</li>
            <li><code>WHERE artist = "Artist Name"</code> - Filter by artist</li>
            <li><code>WHERE year > 1990</code> - Filter by year</li>
            <li><code>WHERE genre = "Electronic"</code> - Filter by genre</li>
            <li><code>ORDER BY year DESC</code> - Sort results</li>
            <li><code>LIMIT 10</code> - Limit results</li>
        </ul>
        
        <h4>Available Fields</h4>
        <ul>
            <li><code>artist</code> - Artist name</li>
            <li><code>album</code> - Album title</li>
            <li><code>year</code> - Release year</li>
            <li><code>genre</code> - Music genre</li>
            <li><code>style</code> - Music style</li>
            <li><code>release_id</code> - Discogs release ID</li>
        </ul>
        
        <h4>Special Commands</h4>
        <ul>
            <li><code>SHOW TABLES;</code> - List available tables</li>
            <li><code>DESCRIBE albums;</code> - Show table structure</li>
            <li><code>CLEAR</code> - Clear query results</li>
            <li><code>HELP</code> - Show this help</li>
        </ul>
    `;
    
    return {
        type: 'help',
        content: helpDiv
    };
}


function convertNaturalLanguageQuery(input) {
    const trimmedInput = input.trim();
    
    // Check if it's already SQL (starts with SQL keywords)
    const sqlKeywords = ['SELECT', 'SHOW', 'DESCRIBE', 'HELP', 'CLEAR'];
    const firstWord = trimmedInput.split(' ')[0].toUpperCase();
    
    if (sqlKeywords.includes(firstWord)) {
        return { query: trimmedInput, converted: false };
    }
    
    // Convert any natural language input to search both artists and albums
    const sqlQuery = `SELECT * FROM albums WHERE artist LIKE "%${trimmedInput}%" OR album LIKE "%${trimmedInput}%";`;
    return {
        query: sqlQuery,
        converted: true,
        convertedSql: sqlQuery
    };
}


function clearTerminal() {
    const terminalContent = document.getElementById('terminalContent');
    const welcomeMessage = document.querySelector('.welcome-message');
    const currentPrompt = document.querySelector('.current-prompt');
    
    // Remove everything except welcome message and current prompt
    const children = Array.from(terminalContent.children);
    children.forEach(child => {
        if (child !== welcomeMessage && child !== currentPrompt) {
            child.remove();
        }
    });
    
    // Clear and focus input
    const queryInput = document.getElementById('queryInput');
    queryInput.value = '';
    queryInput.focus();
}

function showExamples() {
    const modal = document.getElementById('examplesModal');
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function hideExamples() {
    const modal = document.getElementById('examplesModal');
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
}
</script>
{{ end }}