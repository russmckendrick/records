{{ define "window_title" }}{{ .Title | upper }} :: {{ len .Pages }} ALBUMS{{ end }}

{{ define "main" }}
<!-- Breadcrumb -->
<div class="breadcrumb">
    <a href="{{ "/" | relURL }}">Home</a> / <a href="{{ .Parent.RelPermalink }}">{{ .Parent.Title }}</a> / {{ .Title }}
</div>

<!-- Genre/Style Header -->
<div class="taxonomy-header">
    <h1 class="taxonomy-title">{{ .Title | upper }}</h1>
    <div class="taxonomy-stats">
        <span class="album-count">{{ len .Pages }} Albums</span>
        <span class="taxonomy-type">{{ .Type | title }}</span>
    </div>
</div>

<!-- View Toggle Controls -->
{{ partial "album-view-toggle.html" (dict "title" (printf "FOUND %d ALBUMS" (len .Pages))) }}

<!-- Albums Container -->
<div class="db-section">
    {{ $paginator := .Paginate .Pages 20 }}
    {{ partial "album-list-view.html" (dict "albums" $paginator.Pages) }}
    {{ partial "album-cards-view.html" (dict "albums" $paginator.Pages) }}
</div>

<!-- Retro Pagination -->
{{ if gt $paginator.TotalPages 1 }}
<div class="pagination-section">
    <div class="pagination-controls">
        <div class="pagination-info">
            <span class="pagination-label">PAGE {{ $paginator.PageNumber }} OF {{ $paginator.TotalPages }}</span>
            <span class="pagination-stats">SHOWING {{ len $paginator.Pages }} OF {{ $paginator.TotalNumberOfElements }} ALBUMS</span>
        </div>
        <div class="pagination-buttons">
            {{ if $paginator.HasPrev }}
            <a href="{{ $paginator.Prev.URL }}" class="pagination-btn">&lt;&lt; PREV</a>
            {{ else }}
            <span class="pagination-btn disabled">&lt;&lt; PREV</span>
            {{ end }}
            
            {{ $.Scratch.Set "adjacent_links" 2 }}
            {{ $adjacent_links := $.Scratch.Get "adjacent_links" }}
            {{ $max_links := (add (mul $adjacent_links 2) 1) }}
            {{ $lower_limit := (add $adjacent_links 1) }}
            {{ $upper_limit := (sub $paginator.TotalPages $adjacent_links) }}
            
            {{ if gt $paginator.TotalPages $max_links }}
                
                {{ if le $paginator.PageNumber $lower_limit }}
                    {{ range $paginator.Pagers }}
                        {{ if le .PageNumber $max_links }}
                            {{ if eq . $paginator }}
                            <span class="pagination-btn active">{{ .PageNumber }}</span>
                            {{ else }}
                            <a href="{{ .URL }}" class="pagination-btn">{{ .PageNumber }}</a>
                            {{ end }}
                        {{ end }}
                    {{ end }}
                    {{ if lt $max_links $paginator.TotalPages }}
                    <span class="pagination-btn disabled">...</span>
                    <a href="{{ $paginator.Last.URL }}" class="pagination-btn">{{ $paginator.TotalPages }}</a>
                    {{ end }}
                
                {{ else if ge $paginator.PageNumber $upper_limit }}
                    <a href="{{ $paginator.First.URL }}" class="pagination-btn">1</a>
                    <span class="pagination-btn disabled">...</span>
                    {{ range $paginator.Pagers }}
                        {{ if gt .PageNumber (sub $paginator.TotalPages $max_links) }}
                            {{ if eq . $paginator }}
                            <span class="pagination-btn active">{{ .PageNumber }}</span>
                            {{ else }}
                            <a href="{{ .URL }}" class="pagination-btn">{{ .PageNumber }}</a>
                            {{ end }}
                        {{ end }}
                    {{ end }}
                
                {{ else }}
                    <a href="{{ $paginator.First.URL }}" class="pagination-btn">1</a>
                    <span class="pagination-btn disabled">...</span>
                    {{ range $paginator.Pagers }}
                        {{ if and (ge .PageNumber (sub $paginator.PageNumber $adjacent_links)) (le .PageNumber (add $paginator.PageNumber $adjacent_links)) }}
                            {{ if eq . $paginator }}
                            <span class="pagination-btn active">{{ .PageNumber }}</span>
                            {{ else }}
                            <a href="{{ .URL }}" class="pagination-btn">{{ .PageNumber }}</a>
                            {{ end }}
                        {{ end }}
                    {{ end }}
                    <span class="pagination-btn disabled">...</span>
                    <a href="{{ $paginator.Last.URL }}" class="pagination-btn">{{ $paginator.TotalPages }}</a>
                {{ end }}
                
            {{ else }}
                {{ range $paginator.Pagers }}
                    {{ if eq . $paginator }}
                    <span class="pagination-btn active">{{ .PageNumber }}</span>
                    {{ else }}
                    <a href="{{ .URL }}" class="pagination-btn">{{ .PageNumber }}</a>
                    {{ end }}
                {{ end }}
            {{ end }}
            
            {{ if $paginator.HasNext }}
            <a href="{{ $paginator.Next.URL }}" class="pagination-btn">NEXT &gt;&gt;</a>
            {{ else }}
            <span class="pagination-btn disabled">NEXT &gt;&gt;</span>
            {{ end }}
        </div>
    </div>
</div>
{{ end }}

<!-- Include Album View Toggle Scripts -->
{{ partial "album-view-scripts.html" . }}

<style>
/* Taxonomy Page Styles */
.taxonomy-header {
    margin: 2rem 0;
    padding: 2rem;
    border: 1px solid var(--border-color);
    background: var(--window-bg);
    text-align: center;
}

[data-era="90s"] .taxonomy-header {
    border: 1px inset #c0c0c0;
    background: #e0e0e0;
}

.taxonomy-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--text-color);
    margin-bottom: 1rem;
    font-family: var(--font-family);
    letter-spacing: 0.1em;
}

.taxonomy-stats {
    display: flex;
    justify-content: center;
    gap: 2rem;
    align-items: center;
}

.album-count {
    color: var(--accent-color);
    font-family: var(--font-family);
    font-weight: 600;
    font-size: 1.2rem;
}

.taxonomy-type {
    color: var(--secondary-text);
    font-family: var(--font-family);
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: uppercase;
    padding: 0.25rem 0.75rem;
    border: 1px solid var(--border-color);
    background: var(--highlight-bg);
}

[data-era="90s"] .taxonomy-type {
    border: 1px inset #c0c0c0;
    background: #f0f0f0;
}

/* Reuse existing view controls and database styles */
.view-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 2rem 0 1rem 0;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
}

.view-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-color);
    font-family: var(--font-family);
}

.view-toggle {
    display: flex;
    gap: 0.5rem;
}

.view-btn {
    background: var(--window-bg);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    padding: 0.5rem 1rem;
    font-family: var(--font-family);
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.view-btn.active {
    background: var(--highlight-bg);
    color: var(--accent-color);
}

[data-era="90s"] .view-btn {
    border: 1px outset #c0c0c0;
    background: #c0c0c0;
}

[data-era="90s"] .view-btn:hover {
    border: 1px inset #c0c0c0;
}

[data-era="90s"] .view-btn.active {
    background: var(--highlight-bg);
    color: white;
}

/* Database Grid */
.db-section {
    margin: 2rem 0;
}

.db-header {
    display: grid;
    grid-template-columns: 80px 60px 2fr 2fr 1fr 1fr 100px;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 2px solid var(--border-color);
    margin-bottom: 1rem;
    font-weight: 600;
    color: var(--text-color);
    text-transform: uppercase;
    font-size: 0.8rem;
}

.db-row {
    display: grid;
    grid-template-columns: 80px 60px 2fr 2fr 1fr 1fr 100px;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid var(--border-color);
    transition: all 0.3s ease;
    cursor: pointer;
    align-items: center;
}

.db-row:hover {
    background: var(--highlight-bg);
}

[data-era="90s"] .db-row:hover {
    background: var(--highlight-bg);
    color: white;
}

.record-id {
    font-family: var(--font-family);
    color: var(--secondary-text);
    font-size: 0.8rem;
}

.album-cover-mini {
    width: 40px;
    height: 40px;
    background: #222;
    border: 1px solid #444;
    position: relative;
    overflow: hidden;
    background-size: cover;
    background-position: center;
}

[data-era="90s"] .album-cover-mini {
    border: 1px inset #c0c0c0;
    background: #f0f0f0;
}

.album-title {
    color: var(--text-color);
    font-weight: 500;
    font-size: 0.9rem;
}

.artist-name {
    color: var(--secondary-text);
    font-size: 0.9rem;
}

.genre-tag {
    background: rgba(255, 255, 0, 0.2);
    color: var(--accent-color);
    padding: 0.2rem 0.5rem;
    border-radius: 3px;
    font-size: 0.7rem;
    text-transform: uppercase;
    font-weight: 500;
    border: 1px solid var(--accent-color);
}

[data-era="90s"] .genre-tag {
    background: #800080;
    color: white;
    border: 1px outset #800080;
}

.date-added {
    color: var(--secondary-text);
    font-size: 0.8rem;
}

.status-indicator {
    width: 8px;
    height: 8px;
    background: var(--accent-color);
    border-radius: 50%;
    animation: pulse 2s infinite;
}

[data-era="90s"] .status-indicator {
    border-radius: 0;
    background: #008000;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.3; }
    100% { opacity: 1; }
}

/* Card View */
.cards-grid {
    display: none;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 2rem;
}

.cards-grid.active {
    display: grid;
}

.album-card {
    background: var(--window-bg);
    border: 1px solid var(--border-color);
    overflow: hidden;
    transition: all 0.3s ease;
    cursor: pointer;
}

[data-era="90s"] .album-card {
    border: 1px outset #c0c0c0;
    background: #c0c0c0;
}

.album-card:hover {
    background: var(--highlight-bg);
    border-color: var(--accent-color);
}

[data-era="90s"] .album-card:hover {
    border: 1px inset #c0c0c0;
}

.album-cover {
    width: 100%;
    aspect-ratio: 1;
    background-size: cover;
    background-position: center;
    border-bottom: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
}

.album-info {
    padding: 1.5rem;
}

.album-card .album-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-color);
}

.album-card .album-artist {
    color: var(--secondary-text);
    margin-bottom: 1rem;
}

.album-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.album-date {
    color: var(--secondary-text);
    font-size: 0.8rem;
}

.album-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.tag {
    background: rgba(255, 255, 0, 0.2);
    color: var(--accent-color);
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    text-transform: uppercase;
    border: 1px solid var(--accent-color);
}

[data-era="90s"] .tag {
    background: #800080;
    color: white;
    border: 1px outset #800080;
    border-radius: 0;
}

/* Hide/Show Views */
.db-list {
    display: block;
}

.db-list.hidden {
    display: none;
}

@media (max-width: 768px) {
    .taxonomy-header {
        padding: 1rem;
        margin: 1rem 0;
    }
    
    .taxonomy-title {
        font-size: 1.8rem;
    }
    
    .taxonomy-stats {
        flex-direction: column;
        gap: 1rem;
    }
    
    .db-header {
        display: none;
    }
    
    .db-row {
        display: block;
        padding: 1rem;
        border: 1px solid var(--border-color);
        margin-bottom: 0.5rem;
        border-radius: 3px;
    }
    
    .view-controls {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }
    
    .view-toggle {
        justify-content: center;
    }
    
    .cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
    }
}

/* Pagination */
.pagination-section {
    margin: 2rem 0;
    padding: 1.5rem;
    border-top: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
}

.pagination-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.pagination-info {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.pagination-label {
    font-family: var(--font-family);
    font-weight: 600;
    color: var(--text-color);
    font-size: 1rem;
    text-transform: uppercase;
}

.pagination-stats {
    font-family: var(--font-family);
    color: var(--secondary-text);
    font-size: 0.8rem;
    text-transform: uppercase;
}

.pagination-buttons {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    flex-wrap: wrap;
}

.pagination-btn {
    background: var(--window-bg);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    padding: 0.5rem 1rem;
    font-family: var(--font-family);
    font-size: 0.8rem;
    text-decoration: none;
    transition: all 0.3s ease;
    text-transform: uppercase;
    font-weight: 500;
}

.pagination-btn:hover {
    background: var(--highlight-bg);
    color: var(--accent-color);
    text-decoration: none;
}

.pagination-btn.active {
    background: var(--accent-color);
    color: var(--window-bg);
    font-weight: 700;
}

.pagination-btn.disabled {
    background: var(--window-bg);
    color: var(--secondary-text);
    cursor: not-allowed;
    opacity: 0.5;
}

[data-era="90s"] .pagination-btn {
    border: 1px outset #c0c0c0;
    background: #c0c0c0;
}

[data-era="90s"] .pagination-btn:hover {
    border: 1px inset #c0c0c0;
}

[data-era="90s"] .pagination-btn.active {
    background: var(--accent-color);
    color: white;
    border: 1px inset var(--accent-color);
}

[data-era="90s"] .pagination-btn.disabled {
    background: #e0e0e0;
    color: #808080;
    border: 1px outset #e0e0e0;
}

@media (max-width: 768px) {
    .pagination-controls {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
    }
    
    .pagination-buttons {
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .taxonomy-title {
        font-size: 1.5rem;
    }
    
    .cards-grid {
        grid-template-columns: 1fr;
        gap: 0.8rem;
    }
    
    .album-info {
        padding: 1rem;
    }
    
    .album-title {
        font-size: 1rem;
    }
    
    .view-title {
        font-size: 1rem;
    }
    
    .pagination-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.7rem;
    }
    
    .pagination-label {
        font-size: 0.9rem;
    }
}
</style>
{{ end }}